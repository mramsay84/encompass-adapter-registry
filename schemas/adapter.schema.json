{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/mramsay84/encompass-adapter-registry/schemas/adapter.schema.json",
  "title": "Encompass Adapter Definition",
  "description": "Schema for individual adapter.json files",
  "type": "object",
  "required": ["slug", "name", "version", "type", "provider", "authentication"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "slug": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9-]*$",
      "description": "Unique adapter identifier (lowercase, hyphenated)"
    },
    "name": {
      "type": "string",
      "description": "Display name for the adapter"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Adapter version (semver)"
    },
    "description": {
      "type": "string",
      "description": "Brief description of what the adapter does"
    },
    "type": {
      "type": "string",
      "enum": ["payment", "email", "sms", "esignature", "kyc", "storage", "crm", "calendar", "communication", "analytics", "custom"],
      "description": "Adapter category type"
    },
    "provider": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Provider company name"
        },
        "website": {
          "type": "string",
          "format": "uri",
          "description": "Provider website URL"
        },
        "documentation": {
          "type": "string",
          "format": "uri",
          "description": "API documentation URL"
        },
        "logo": {
          "type": "string",
          "description": "Logo URL or data URI"
        }
      }
    },
    "authentication": {
      "type": "object",
      "required": ["type", "fields"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["oauth2", "api_key", "basic", "bearer", "jwt", "custom"],
          "description": "Authentication method"
        },
        "fields": {
          "type": "array",
          "description": "User-facing credential fields (e.g., tenant_id for org users)",
          "items": {
            "$ref": "#/$defs/authField"
          }
        },
        "oauth_app_fields": {
          "type": "array",
          "description": "OAuth app credential fields for super admin (client_id, client_secret, redirect_uri)",
          "items": {
            "$ref": "#/$defs/authField"
          }
        },
        "oauth2": {
          "type": "object",
          "description": "OAuth2 configuration (when type is oauth2)",
          "properties": {
            "authUrl": {
              "type": "string",
              "format": "uri",
              "description": "Authorization URL"
            },
            "tokenUrl": {
              "type": "string",
              "format": "uri",
              "description": "Token URL"
            },
            "scopes": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Required OAuth scopes"
            },
            "pkce": {
              "type": "boolean",
              "description": "Whether to use PKCE"
            }
          }
        },
        "testEndpoint": {
          "type": "string",
          "description": "Endpoint to test credentials validity"
        }
      }
    },
    "rateLimit": {
      "type": "object",
      "description": "Rate limiting configuration",
      "properties": {
        "requestsPerMinute": {
          "type": "integer",
          "minimum": 1
        },
        "requestsPerHour": {
          "type": "integer",
          "minimum": 1
        },
        "requestsPerDay": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "aiDescription": {
      "type": "string",
      "description": "Description for AI context - explains what this adapter does"
    },
    "aiInstructions": {
      "type": "string",
      "description": "Instructions for AI on how to use this adapter"
    },
    "setupInstructions": {
      "type": "string",
      "description": "Human-readable setup instructions (markdown)"
    },
    "icon": {
      "type": "string",
      "description": "Icon identifier or URL"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Searchable tags"
    }
  },
  "$defs": {
    "authField": {
      "type": "object",
      "required": ["name", "label", "type", "required"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Field identifier"
        },
        "label": {
          "type": "string",
          "description": "Display label"
        },
        "type": {
          "type": "string",
          "enum": ["text", "password", "url", "email", "textarea"],
          "description": "Input field type"
        },
        "required": {
          "type": "boolean",
          "description": "Whether the field is required"
        },
        "placeholder": {
          "type": "string",
          "description": "Placeholder text"
        },
        "helpText": {
          "type": "string",
          "description": "Help text for the field"
        },
        "defaultValue": {
          "type": "string",
          "description": "Default value"
        }
      }
    }
  }
}
